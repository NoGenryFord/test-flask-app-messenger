<!DOCTYPE html>

<!-- This is the main template for the P2P messenger -->
<html>

<!-- Header section -->

<head>
    <title>Tiger Messenger</title>
</head>

<!-- Body section -->

<body>
    <h1>Welcome to Tiger Messenger!</h1>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    <ul class="flash-messages">
        {% for category, message in messages %}
        <li class="{{ category }}">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    {% endwith %}

    {% if not session.get('user_id') %}
    <h2>Sign up</h2>
    <form method="POST" action="/register">
        <label for="reg_username">Username:</label><br>
        <input type="text" id="reg_username" name="username" required><br><br>
        <label for="reg_password">Password:</label><br>
        <input type="password" id="reg_password" name="password" required><br><br>
        <button type="submit">Register</button>
    </form>

    <hr>

    <h2>Login</h2>
    <form method="POST" action="/login">
        <label for="login_username">Username:</label><br>
        <input type="text" id="login_username" name="username" required><br><br>
        <label for="login_password">Password:</label><br>
        <input type="password" id="login_password" name="password" required><br><br>
        <button type="submit">Login</button>
    </form>

    {% else %}
    <p>You are logged in as: <strong>{{ session.get('username') }}</strong> <a href="/logout">Logout</a></p>

    <hr>

    <h2>Online Users:</h2>
     <ul id="onlineUsers">
        {% for username in online_users.values() %}
            <li>{{ username }}</li>
        {% endfor %}
    </ul>

                
    <div id="connectionStatus">Not connected</div>
    <button id="connectButton">Connect to Peer</button> {# This button will initiate the P2P connection #}

    <hr>

    <h2>Chat:</h2>
    <div id="messages">
       
    </div>
    <input type="text" id="messageInput" placeholder="Enter your message">
    <button id="sendButton">Send (WebSocket)</button>
    <input type="text" id="p2pMessageInput" placeholder="Enter P2P message">
    <button id="sendP2PButton">Send (P2P)</button>
    {% endif %}

    <!-- Include the JavaScript file for handling the messaging functionality -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>

</html>